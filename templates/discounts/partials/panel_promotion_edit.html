{% load djicons i18n djicons djicons %}

<div x-data="{ confirmDelete: false }">

    <!-- Header -->
    <div class="side-sheet-header">
        <h3 class="sheet-title">{% trans "Edit Promotion" %}</h3>
        <button class="sheet-close" @click="closePanel()">
            {% icon "close-outline" %}
        </button>
    </div>

    <!-- Body -->
    <div class="side-sheet-content">
        <form id="edit-promotion-form"
              hx-post="{% url 'discounts:promotion_edit' promotion.id %}"
              hx-target="#datatable-body"
              hx-swap="innerHTML"
              @htmx:after-request="closePanel()"
              class="flex flex-col gap-4 p-6">
            {% csrf_token %}

            <!-- Name -->
            <div>
                <label class="text-sm font-medium mb-1 block">{% trans "Name" %} *</label>
                <input type="text" name="name" class="input input-sm w-full"
                       value="{{ promotion.name }}" placeholder="{% trans 'Promotion name' %}" required>
            </div>

            <!-- Description -->
            <div>
                <label class="text-sm font-medium mb-1 block">{% trans "Description" %}</label>
                <textarea name="description" class="textarea textarea-sm w-full" rows="2"
                          placeholder="{% trans 'Promotion description...' %}">{{ promotion.description }}</textarea>
            </div>

            <!-- Discount Type -->
            <div>
                <label class="text-sm font-medium mb-1 block">{% trans "Discount Type" %} *</label>
                <select name="discount_type" class="select select-sm w-full" required>
                    <option value="percentage" {% if promotion.discount_type == 'percentage' %}selected{% endif %}>{% trans "Percentage" %}</option>
                    <option value="fixed" {% if promotion.discount_type == 'fixed' %}selected{% endif %}>{% trans "Fixed Amount" %}</option>
                    <option value="buy_x_get_y" {% if promotion.discount_type == 'buy_x_get_y' %}selected{% endif %}>{% trans "Buy X Get Y" %}</option>
                </select>
            </div>

            <!-- Discount Value -->
            <div>
                <label class="text-sm font-medium mb-1 block">{% trans "Discount Value" %} *</label>
                <input type="number" name="discount_value" class="input input-sm w-full"
                       min="0" step="0.01" value="{{ promotion.discount_value }}" required>
            </div>

            <!-- Scope -->
            <div>
                <label class="text-sm font-medium mb-1 block">{% trans "Scope" %}</label>
                <select name="scope" class="select select-sm w-full">
                    <option value="order" {% if promotion.scope == 'order' %}selected{% endif %}>{% trans "Entire Order" %}</option>
                    <option value="products" {% if promotion.scope == 'products' %}selected{% endif %}>{% trans "Specific Products" %}</option>
                    <option value="categories" {% if promotion.scope == 'categories' %}selected{% endif %}>{% trans "Specific Categories" %}</option>
                </select>
            </div>

            <!-- Min Purchase -->
            <div>
                <label class="text-sm font-medium mb-1 block">{% trans "Min. Purchase" %}</label>
                <input type="number" name="min_purchase" class="input input-sm w-full"
                       min="0" step="0.01" value="{{ promotion.min_purchase }}">
            </div>

            <!-- Max Discount -->
            <div>
                <label class="text-sm font-medium mb-1 block">{% trans "Max Discount" %}</label>
                <input type="number" name="max_discount" class="input input-sm w-full"
                       min="0" step="0.01" value="{{ promotion.max_discount }}">
                <span class="text-xs text-base-content/50 mt-1 block">{% trans "Leave empty for no limit" %}</span>
            </div>

            <!-- Valid From -->
            <div>
                <label class="text-sm font-medium mb-1 block">{% trans "Valid From" %} *</label>
                <input type="datetime-local" name="valid_from" class="input input-sm w-full"
                       value="{{ promotion.valid_from|date:'Y-m-d\TH:i' }}" required>
            </div>

            <!-- Valid Until -->
            <div>
                <label class="text-sm font-medium mb-1 block">{% trans "Valid Until" %} *</label>
                <input type="datetime-local" name="valid_until" class="input input-sm w-full"
                       value="{{ promotion.valid_until|date:'Y-m-d\TH:i' }}" required>
            </div>

            <!-- Days of Week -->
            <div>
                <label class="text-sm font-medium mb-1 block">{% trans "Days of Week" %}</label>
                <input type="text" name="days_of_week" class="input input-sm w-full"
                       value="{{ promotion.days_of_week }}"
                       placeholder="{% trans 'e.g. Mon,Tue,Wed' %}">
                <span class="text-xs text-base-content/50 mt-1 block">{% trans "Leave empty for every day" %}</span>
            </div>

            <!-- Start Time -->
            <div>
                <label class="text-sm font-medium mb-1 block">{% trans "Start Time" %}</label>
                <input type="time" name="start_time" class="input input-sm w-full"
                       value="{{ promotion.start_time|time:'H:i' }}">
            </div>

            <!-- End Time -->
            <div>
                <label class="text-sm font-medium mb-1 block">{% trans "End Time" %}</label>
                <input type="time" name="end_time" class="input input-sm w-full"
                       value="{{ promotion.end_time|time:'H:i' }}">
            </div>

            <!-- Priority -->
            <div>
                <label class="text-sm font-medium mb-1 block">{% trans "Priority" %}</label>
                <input type="number" name="priority" class="input input-sm w-full"
                       min="0" value="{{ promotion.priority }}">
            </div>

            <!-- Stackable -->
            <div>
                <label class="checkbox checkbox-sm">
                    <input type="checkbox" name="stackable" {% if promotion.stackable %}checked{% endif %}>
                    <span class="checkbox-mark"></span>
                    <span class="ml-2 text-sm font-medium">{% trans "Stackable" %}</span>
                </label>
                <span class="text-xs text-base-content/50 mt-1 block">{% trans "Can be combined with other discounts" %}</span>
            </div>

            <!-- Active -->
            <div>
                <label class="checkbox checkbox-sm">
                    <input type="checkbox" name="is_active" {% if promotion.is_active %}checked{% endif %}>
                    <span class="checkbox-mark"></span>
                    <span class="ml-2 text-sm font-medium">{% trans "Active" %}</span>
                </label>
            </div>
        </form>

        <!-- Delete Section -->
        <div class="border-t border-base-300 pt-4 mt-4 px-6 pb-6">
            <h4 class="font-semibold text-sm mb-3 text-error">{% trans "Danger Zone" %}</h4>

            <template x-if="!confirmDelete">
                <button type="button" class="btn btn-sm btn-outline color-error w-full"
                        @click="confirmDelete = true">
                    {% icon "trash-outline" %}
                    {% trans "Delete Promotion" %}
                </button>
            </template>

            <template x-if="confirmDelete">
                <div>
                    <p class="text-error text-sm font-semibold mb-3">
                        {% trans "Are you sure? This action cannot be undone." %}
                    </p>
                    <div class="flex gap-2">
                        <button type="button" class="btn btn-sm btn-outline flex-1"
                                @click="confirmDelete = false">
                            {% trans "Cancel" %}
                        </button>
                        <button type="button" class="btn btn-sm color-error flex-1"
                                hx-post="{% url 'discounts:promotion_delete' promotion.id %}"
                                hx-target="#datatable-body"
                                hx-swap="innerHTML"
                                @click="closePanel()">
                            {% icon "trash-outline" %}
                            {% trans "Delete" %}
                        </button>
                    </div>
                </div>
            </template>
        </div>
    </div>

    <!-- Footer -->
    <div class="side-sheet-footer">
        <div class="flex justify-end gap-2">
            <button type="button" class="btn btn-ghost btn-sm" @click="closePanel()">
                {% trans "Cancel" %}
            </button>
            <button type="submit" form="edit-promotion-form" class="btn btn-sm color-primary">
                {% icon "checkmark-outline" %}
                {% trans "Save" %}
            </button>
        </div>
    </div>

</div>
